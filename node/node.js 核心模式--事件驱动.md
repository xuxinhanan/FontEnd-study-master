介绍 Node.js 的核心模式 —— reactor 模式了（又称事件驱动）。

reactor模式运作如下：

![image-20220711234123344](C:\Users\64554\AppData\Roaming\Typora\typora-user-images\image-20220711234123344.png)



1. 应用程序向事件多路分离器提交非阻塞 I/O 请求，提交的时候还要指定 Handler 事件处理程序。
2. 事件多路分离器执行完 I/O 操作后，会向事件队列推送相应的事件。
3. 此时，事件循环会迭代事件队列中的各项事件。
4. 并针对每项事件触发与之相关的 handler。
5. 这个 Handler 是应用程序的一部分，它在执行完自己的逻辑后，把**控制权返还给事件循环**（图中的5a）。并且在 Handler 执行过程中，它也可能会提出新的异步操作请求（图中的5b），从而向事件多路分离器提交新的请求。
6. 事件循环把事件队列的所有事件处理完毕后，事件循环会阻塞于事件多路分离器这里（由于单线程，参考上一节伪代码），直到新的事件出现。

+ 如果事件分离器已经没有操作需要处理，而且事件队列之中也没有待处理的事件，那么 Node.js 应用程序将会退出。



总结：reactor 模式把每项 I/O 操作都同某个事件处理程序( callback 函数 )关联起来，只要事件循环处理某个事件，handler 就会触发。 

**从以上也可以看出 Node.js 应用程序的一个特点，大量地使用回调函数以避免阻塞和等待。**

----------



Nodejs 的异步回调模式：通过 nodejs 构建的服务端应用程序假设有5个用户访问，而第一个用户的访问操作是耗时的，那么由于 nodejs 单线程的原因，会阻塞后续用户的访问。

为了解决这个问题，nodejs 大量采用异步回调模式，会阻塞线程的操作异步执行，其他操作同步进行。

## 

