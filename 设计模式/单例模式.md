

> **ä¿è¯ä¸€ä¸ªç±»ä»…æœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶æä¾›ä¸€ä¸ªè®¿é—®å®ƒçš„å…¨å±€è®¿é—®ç‚¹**ï¼Œè¿™æ ·çš„æ¨¡å¼å°±å«åšå•ä¾‹æ¨¡å¼ã€‚

![image-20220206181649135](https://windliangblog.oss-cn-beijing.aliyuncs.com/windliangblog.oss-cn-beijing.aliyuncs.comimage-20220206181649135.png)

ç”¨ES6æ¨¡æ‹Ÿä¸€ä¸‹ï¼š

~~~js
class Singleton {
  static getInstance() {
    if (!Singleton.instance) {
      Singleton.instance = new Singleton();
    }
    return Singleton.instance;
  }
}
~~~



## åœºæ™¯

### **Module**

é€šå¸¸çš„å•ä¾‹å¯¹è±¡å¯èƒ½ä¼šæ˜¯ä¸‹è¾¹çš„æ ·å­ï¼Œæš´éœ²å‡ ä¸ªæ–¹æ³•ä¾›å¤–ç•Œä½¿ç”¨ã€‚

```js
var Singleton = {
  method1: function () {
    // ...
  },
  method2: function () {
    // ...
  }
};
```

ä½†å¦‚æœ`Singleton` æœ‰ç§æœ‰å±æ€§ï¼Œå¯ä»¥å†™æˆä¸‹è¾¹çš„æ ·å­ï¼š

```js
var Singleton = {
  privateVar: 'æˆ‘æ˜¯ç§æœ‰å±æ€§',
  method1: function () {
    // ...
  },
  method2: function () {
    // ...
  }
};
```

ä½†æ­¤æ—¶å¤–ç•Œå°±å¯ä»¥é€šè¿‡ `Singleton` éšæ„ä¿®æ”¹ `privateVar` çš„å€¼ã€‚

ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ©é—­åŒ…ï¼Œé€šè¿‡ `IIFE (Immediately Invoked Function Expression)` å°†ä¸€äº›å±æ€§å’Œæ–¹æ³•ç§æœ‰åŒ–ã€‚

```js
var myInstance = (function() {
  var privateVar = '';

  function privateMethod () {
    // ...
  }

  return { 
    method1: function () {
    },
    method2: function () {
    }
  };
})();
```

ä½†éšç€ `ES6 Module` çš„å‡ºç°ï¼Œæˆ‘ä»¬å¾ˆå°‘åƒä¸Šè¾¹é‚£æ ·å»å®šä¹‰ä¸€ä¸ªæ¨¡å—äº†ï¼Œè€Œæ˜¯é€šè¿‡å•æ–‡ä»¶ï¼Œä¸€ä¸ªæ–‡ä»¶å°±æ˜¯ä¸€ä¸ªæ¨¡å—ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥çœ‹æˆä¸€ä¸ª**å•ä¾‹å¯¹è±¡**ã€‚

```js
// ğŸ“ singleton.js
const somePrivateState = []

function privateMethod () {
  // ...
}

export default {
  method1() {
    // ...
  },
  method2() {
    // ...
  }
}
```

ç„¶åä½¿ç”¨çš„æ—¶å€™ `import` å³å¯ã€‚

```js
// ğŸ“ main.js
import Singleton from './singleton.js'
// ...
```

å³ä½¿æœ‰å¦ä¸€ä¸ªæ–‡ä»¶ä¹Ÿ `import` äº†åŒä¸€ä¸ªæ–‡ä»¶ã€‚

```js
// ğŸ“ main2.js
import Singleton from './singleton.js'
```

ç”±äº`Module`çš„ç‰¹æ€§ï¼š**æ¨¡å—ä»£ç ä»…åœ¨ç¬¬ä¸€æ¬¡å¯¼å…¥æ—¶è¢«è§£æ**ï¼Œå› æ­¤è¿™ä¸¤ä¸ªä¸åŒæ–‡ä»¶çš„ `import`çš„`Singleton` æ˜¯åŒä¸€ä¸ªå¯¹è±¡ã€‚

é‚£å¦‚æœé€šè¿‡ `Webpack` å°† `ES6` è½¬æˆ `ES5` ä»¥åå‘¢ï¼Œè¿™ç§æ–¹å¼è¿˜ä¼šæ˜¯å•ä¾‹å¯¹è±¡å—ï¼Ÿ

ç­”æ¡ˆå½“ç„¶æ˜¯è‚¯å®šçš„ï¼Œå¯ä»¥çœ‹ä¸€ä¸‹ `Webpack` æ‰“åŒ…çš„äº§ç‰©ï¼Œå…¶å®å°±æ˜¯ä½¿ç”¨äº† `IIFE` ï¼ŒåŒæ—¶å°†ç¬¬ä¸€æ¬¡ `import` çš„æ¨¡å—è¿›è¡Œäº†ç¼“å­˜ï¼Œç¬¬äºŒæ¬¡ `import` çš„æ—¶å€™ä¼šä½¿ç”¨ä¹‹å‰çš„ç¼“å­˜ã€‚å¯ä»¥çœ‹ä¸‹ `__webpack_require__` çš„å®ç°ï¼Œå’Œå•ä¾‹æ¨¡å¼çš„é€»è¾‘æ˜¯ä¸€æ ·çš„ã€‚

```js
function __webpack_require__(moduleId) {
  var cachedModule = __webpack_module_cache__[moduleId];
  
  // å•ä¾‹æ¨¡å¼çš„åº”ç”¨
  if (cachedModule !== undefined) {
    return cachedModule.exports;
  }

  var module = (__webpack_module_cache__[moduleId] = {
    exports: {},
  });
  __webpack_modules__[moduleId](
    module,
    module.exports,
    __webpack_require__
  );
  return module.exports;
}
```

### Mitt äº‹ä»¶æ€»çº¿

~~~ts
export default function mitt<Events extends Record<EventType, unknown>>(
	all?: EventHandlerMap<Events>
): Emitter<Events> {
	type GenericEventHandler =
		| Handler<Events[keyof Events]>
		| WildcardHandler<Events>;
	all = all || new Map();

	return {
		all,

		on<Key extends keyof Events>(type: Key, handler: GenericEventHandler) {
			// ......
		},

		off<Key extends keyof Events>(type: Key, handler?: GenericEventHandler) {
			// ......
		},

		emit<Key extends keyof Events>(type: Key, evt?: Events[Key]) {
			// ......
	};
}
~~~

å¯ä»¥çœ‹åˆ°å®ƒç›´æ¥å°† `mitt` è¿™ä¸ªå‡½æ•°å¯¼å‡ºäº†ï¼Œå¦‚æœæ¯ä¸ªé¡µé¢éƒ½å„è‡ª `import` å®ƒï¼Œç„¶åé€šè¿‡ `mitt()` æ¥ç”Ÿæˆå¯¹è±¡ï¼Œé‚£å‘å¸ƒè®¢é˜…å°±ä¹±å¥—äº†ï¼Œå› ä¸ºå®ƒä»¬ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡äº†ã€‚

ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥æ–°å»ºä¸€ä¸ªæ¨¡å— / æ–‡ä»¶ï¼Œç„¶å `export` ä¸€ä¸ªå®ä¾‹åŒ–å¯¹è±¡ï¼Œå…¶ä»–é¡µé¢å»ä½¿ç”¨è¿™ä¸ªå¯¹è±¡å°±å®ç°å•ä¾‹æ¨¡å¼äº†ã€‚

~~~js
import mitt from 'mitt'

const emitter = mitt()
~~~

### å®ç°ä¸€ä¸ª Storage

> å®ç°Storageï¼Œä½¿å¾—è¯¥å¯¹è±¡ä¸ºå•ä¾‹ï¼ŒåŸºäº localStorage è¿›è¡Œå°è£…ã€‚å®ç°æ–¹æ³• setItem(key,value) å’Œ getItem(key)ã€‚

å•ä¾‹æ¨¡å¼æƒ³è¦åšåˆ°çš„æ˜¯ï¼Œ**ä¸ç®¡æˆ‘ä»¬å°è¯•å»åˆ›å»ºå¤šå°‘æ¬¡ï¼Œå®ƒéƒ½åªç»™ä½ è¿”å›ç¬¬ä¸€æ¬¡æ‰€åˆ›å»ºçš„é‚£å”¯ä¸€çš„ä¸€ä¸ªå®ä¾‹**ã€‚

è¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œå°±éœ€è¦æ„é€ å‡½æ•°**å…·å¤‡åˆ¤æ–­è‡ªå·±æ˜¯å¦å·²ç»åˆ›å»ºè¿‡ä¸€ä¸ªå®ä¾‹**çš„èƒ½åŠ›ã€‚æˆ‘ä»¬ç°åœ¨æŠŠè¿™æ®µåˆ¤æ–­é€»è¾‘å†™æˆä¸€ä¸ªé™æ€æ–¹æ³•(å…¶å®ä¹Ÿå¯ä»¥ç›´æ¥å†™å…¥æ„é€ å‡½æ•°çš„å‡½æ•°ä½“é‡Œï¼‰ï¼š

~~~js
class Storage {
  static getInstance() {
    if (!Storage.instance) {
      Storage.instance = new Storage();
    }
    return Storage.instance;
  }
  getItem(key) {
    return localStorage.getItem(key);
  }
  setItem(key, value) {
    return localStorage.setItem(key, value);
  }
}
~~~

ES5ç‰ˆæœ¬ï¼š

~~~js
function StorageBase() {}

StorageBase.prototype.getItem = function (key) {
  return localStorage.getItem(key);
};
StorageBase.prototype.setItem = function (key, value) {
  return localStorage.setItem(key, value);
};

const Storage = (function () {
  let instance = null;
  return function () {
    if (!instance) {
      instance = new StorageBase();
    }
    return instance;
  };
})();
~~~

### å®ç°ä¸€ä¸ªå…¨å±€Modalå¼¹æ¡†



~~~html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>å•ä¾‹æ¨¡å¼å¼¹æ¡†</title>
</head>
<style>
    #modal {
        height: 200px;
        width: 200px;
        line-height: 200px;
        position: fixed;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
        border: 1px solid black;
        text-align: center;
    }
</style>
<body>
    <button id="open">æ‰“å¼€å¼¹æ¡†</button>
    <button id="close">å…³é—­å¼¹æ¡†</button>
</body>
<script>
    // ES5å®ç°å•ä¾‹æ¨¡å¼
    const Modal = (function(){
        let modal = null;
        return function() {
            if(!modal) {
                modal = document.createElement('div');
                modal.innerHTML = 'æˆ‘æ˜¯ä¸€ä¸ªå…¨å±€å”¯ä¸€çš„Modal';
                modal.id = 'modal';
                modal.style.display = 'none';
                document.body.appendChild(modal);
            }
            return modal;
        }
    })()

    document.getElementById('open').addEventListener('click', function(){
        const modal = new Modal();
        modal.style.display = 'block';
    })

    document.getElementById('close').addEventListener('click', function(){
        const modal = new Modal();
        if (modal) {
            modal.style.display = 'none';
        }
    })
</script>
</html>
~~~



















