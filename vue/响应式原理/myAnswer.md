响应式指的是数据响应式，当数据变化的时候自动重新执行相关副作用函数。

要实现这个目标，需要拦截数据的读取和设置操作，当读取数据时，收集关联副作用函数；当修改数据时，自动执行这些副作用函数。

而在 vue 里，其实在 mount 过程中，会实例化一个渲染 watcher，在这个过程中会执行 render() 方法生成虚拟 DOM，而生成虚拟 DOM 的过程中又会访问数据，从而触发数据的 getter 方法。这时就完成了依赖的收集。

那么当我们在组件中修改了响应式数据，就会触发 setter 的逻辑，于是通过 deps 去通知关联的 `watcher`执行更新逻辑，这时会把当前 `watcher` 推送到一个队列中，在 `nextTick` 后才会真正执行 `watcher` 的回调函数去更新视图。





----------





完善的响应式系统需要：

1. 一个能明确记录具体数据与副作用函数的联系的数据结构

   为此，vue 采用一个 weakMap。它的键是响应式对象，它的值是一个 Map。而这个 Map 的键是响应式对象的属性，而值是这个属性的依赖集合，用一个 Set 来存储。

2. 需要处理分支切换的问题，比如三元表达式的判断条件改变时，代码执行的分支跟着改变。

   为了解决这个问题，需要 watcher 中添加 deps 数组，用来存储所有包含当前副作用函数依赖的数据。那么每次依赖执行时，就从 deps 数组里取出依赖并删除与当前副作用的联系。

3. 





### 双向绑定原理 v-model

在处理v-model指令的时候，为该dom添加input事件（或change），输入时就去修改对应的属性的值，实现了页面驱动数据。
