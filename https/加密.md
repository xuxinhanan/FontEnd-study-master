### 对称加密+非对称加密=安全层三次握手

![img](https://static001.geekbang.org/resource/image/d5/45/d5cd34dbf3636ebc0e809aa424c53845.png?wh=1670*1022)



从图中可以看出，加密流程是这样的：

+ 首先浏览器向服务器发送对称加密套件列表[^1]、非对称加密套件列表和随机数 client-random；
+ 服务器保存随机数 client-random，选择对称加密和非对称加密的套件，然后生成随机数 service-random，向浏览器发送选择的加密套件、service-random 和公钥；
+ 浏览器保存公钥，并生成随机数 pre-master，然后利用公钥对 pre-master 加密，并向服务器发送加密后的数据；
+ 最后服务器拿出自己的私钥，解密出 pre-master 数据，并返回确认消息。



到此为止，服务器和浏览器就有了共同的 client-random、service-random 和 pre-master，**然后服务器和浏览器会使用这三组随机数生成对称密钥**，因为服务器和浏览器使用同一套方法来生成密钥，所以最终生成的密钥也是相同的。

有了对称加密的密钥之后，双方就可以使用对称加密的方式来传输数据了。

需要特别注意的一点，**pre-master 是经过公钥加密之后传输的，所以黑客无法获取到 pre-master，这样黑客就无法生成密钥，也就保证了黑客无法破解传输过程中的数据了。**



[^1]: 这里的加密套件是指加密的方法，加密套件列表就是指浏览器能支持多少种加密方法列表。

